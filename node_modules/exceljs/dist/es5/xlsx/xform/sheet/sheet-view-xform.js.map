{"version":3,"sources":["../../../../../lib/xlsx/xform/sheet/sheet-view-xform.js"],"names":["colCache","require","BaseXform","VIEW_STATES","frozen","frozenSplit","split","SheetViewXform","model","state","xmlStream","openNode","workbookViewId","add","name","value","included","addAttribute","rightToLeft","tabSelected","showRuler","showRowColHeaders","showGridLines","zoomScale","zoomScaleNormal","style","topLeftCell","xSplit","ySplit","activePane","getAddress","address","leafNode","undefined","pane","activeCell","sqref","closeNode","node","sheetView","parseInt","attributes","view","selections","selection","topLeft","module","exports"],"mappings":"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","sourcesContent":["const colCache = require('../../../utils/col-cache');\nconst BaseXform = require('../base-xform');\n\nconst VIEW_STATES = {\n  frozen: 'frozen',\n  frozenSplit: 'frozen',\n  split: 'split',\n};\n\nclass SheetViewXform extends BaseXform {\n  get tag() {\n    return 'sheetView';\n  }\n\n  prepare(model) {\n    switch (model.state) {\n      case 'frozen':\n      case 'split':\n        break;\n      default:\n        model.state = 'normal';\n        break;\n    }\n  }\n\n  render(xmlStream, model) {\n    xmlStream.openNode('sheetView', {\n      workbookViewId: model.workbookViewId || 0,\n    });\n    const add = function(name, value, included) {\n      if (included) {\n        xmlStream.addAttribute(name, value);\n      }\n    };\n    add('rightToLeft', '1', model.rightToLeft === true);\n    add('tabSelected', '1', model.tabSelected);\n    add('showRuler', '0', model.showRuler === false);\n    add('showRowColHeaders', '0', model.showRowColHeaders === false);\n    add('showGridLines', '0', model.showGridLines === false);\n    add('zoomScale', model.zoomScale, model.zoomScale);\n    add('zoomScaleNormal', model.zoomScaleNormal, model.zoomScaleNormal);\n    add('view', model.style, model.style);\n\n    let topLeftCell;\n    let xSplit;\n    let ySplit;\n    let activePane;\n    switch (model.state) {\n      case 'frozen':\n        xSplit = model.xSplit || 0;\n        ySplit = model.ySplit || 0;\n        topLeftCell = model.topLeftCell || colCache.getAddress(ySplit + 1, xSplit + 1).address;\n        activePane = (model.xSplit && model.ySplit && 'bottomRight') || (model.xSplit && 'topRight') || 'bottomLeft';\n\n        xmlStream.leafNode('pane', {\n          xSplit: model.xSplit || undefined,\n          ySplit: model.ySplit || undefined,\n          topLeftCell,\n          activePane,\n          state: 'frozen',\n        });\n        xmlStream.leafNode('selection', {\n          pane: activePane,\n          activeCell: model.activeCell,\n          sqref: model.activeCell,\n        });\n        break;\n      case 'split':\n        if (model.activePane === 'topLeft') {\n          model.activePane = undefined;\n        }\n        xmlStream.leafNode('pane', {\n          xSplit: model.xSplit || undefined,\n          ySplit: model.ySplit || undefined,\n          topLeftCell: model.topLeftCell,\n          activePane: model.activePane,\n        });\n        xmlStream.leafNode('selection', {\n          pane: model.activePane,\n          activeCell: model.activeCell,\n          sqref: model.activeCell,\n        });\n        break;\n      case 'normal':\n        if (model.activeCell) {\n          xmlStream.leafNode('selection', {\n            activeCell: model.activeCell,\n            sqref: model.activeCell,\n          });\n        }\n        break;\n      default:\n        break;\n    }\n    xmlStream.closeNode();\n  }\n\n  parseOpen(node) {\n    switch (node.name) {\n      case 'sheetView':\n        this.sheetView = {\n          workbookViewId: parseInt(node.attributes.workbookViewId, 10),\n          rightToLeft: node.attributes.rightToLeft === '1',\n          tabSelected: node.attributes.tabSelected === '1',\n          showRuler: !(node.attributes.showRuler === '0'),\n          showRowColHeaders: !(node.attributes.showRowColHeaders === '0'),\n          showGridLines: !(node.attributes.showGridLines === '0'),\n          zoomScale: parseInt(node.attributes.zoomScale || '100', 10),\n          zoomScaleNormal: parseInt(node.attributes.zoomScaleNormal || '100', 10),\n          style: node.attributes.view,\n        };\n        this.pane = undefined;\n        this.selections = {};\n        return true;\n\n      case 'pane':\n        this.pane = {\n          xSplit: parseInt(node.attributes.xSplit || '0', 10),\n          ySplit: parseInt(node.attributes.ySplit || '0', 10),\n          topLeftCell: node.attributes.topLeftCell,\n          activePane: node.attributes.activePane || 'topLeft',\n          state: node.attributes.state,\n        };\n        return true;\n\n      case 'selection': {\n        const name = node.attributes.pane || 'topLeft';\n        this.selections[name] = {\n          pane: name,\n          activeCell: node.attributes.activeCell,\n        };\n        return true;\n      }\n\n      default:\n        return false;\n    }\n  }\n\n  parseText() {}\n\n  parseClose(name) {\n    let model;\n    let selection;\n    switch (name) {\n      case 'sheetView':\n        if (this.sheetView && this.pane) {\n          model = this.model = {\n            workbookViewId: this.sheetView.workbookViewId,\n            rightToLeft: this.sheetView.rightToLeft,\n            state: VIEW_STATES[this.pane.state] || 'split', // split is default\n            xSplit: this.pane.xSplit,\n            ySplit: this.pane.ySplit,\n            topLeftCell: this.pane.topLeftCell,\n            showRuler: this.sheetView.showRuler,\n            showRowColHeaders: this.sheetView.showRowColHeaders,\n            showGridLines: this.sheetView.showGridLines,\n            zoomScale: this.sheetView.zoomScale,\n            zoomScaleNormal: this.sheetView.zoomScaleNormal,\n          };\n          if (this.model.state === 'split') {\n            model.activePane = this.pane.activePane;\n          }\n          selection = this.selections[this.pane.activePane];\n          if (selection && selection.activeCell) {\n            model.activeCell = selection.activeCell;\n          }\n          if (this.sheetView.style) {\n            model.style = this.sheetView.style;\n          }\n        } else {\n          model = this.model = {\n            workbookViewId: this.sheetView.workbookViewId,\n            rightToLeft: this.sheetView.rightToLeft,\n            state: 'normal',\n            showRuler: this.sheetView.showRuler,\n            showRowColHeaders: this.sheetView.showRowColHeaders,\n            showGridLines: this.sheetView.showGridLines,\n            zoomScale: this.sheetView.zoomScale,\n            zoomScaleNormal: this.sheetView.zoomScaleNormal,\n          };\n          selection = this.selections.topLeft;\n          if (selection && selection.activeCell) {\n            model.activeCell = selection.activeCell;\n          }\n          if (this.sheetView.style) {\n            model.style = this.sheetView.style;\n          }\n        }\n        return false;\n      default:\n        return true;\n    }\n  }\n\n  reconcile() {}\n}\n\nmodule.exports = SheetViewXform;\n"],"file":"sheet-view-xform.js"}