{"version":3,"sources":["../../../../../lib/xlsx/xform/table/table-xform.js"],"names":["XmlStream","require","BaseXform","ListXform","AutoFilterXform","TableColumnXform","TableStyleInfoXform","TableXform","map","autoFilter","tableColumns","tag","count","empty","childXform","tableStyleInfo","model","options","prepare","columns","xmlStream","openXml","StdDocAttributes","openNode","TABLE_ATTRIBUTES","id","name","displayName","ref","tableRef","totalsRowCount","totalsRow","undefined","totalsRowShown","headerRowCount","headerRow","render","style","closeNode","node","parser","parseOpen","attributes","reset","text","parseText","parseClose","autoFilterRef","forEach","column","index","filterButton","dxfId","styles","getDxfStyle","module","exports"],"mappings":"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","sourcesContent":["const XmlStream = require('../../../utils/xml-stream');\n\nconst BaseXform = require('../base-xform');\nconst ListXform = require('../list-xform');\n\nconst AutoFilterXform = require('./auto-filter-xform');\nconst TableColumnXform = require('./table-column-xform');\nconst TableStyleInfoXform = require('./table-style-info-xform');\n\nclass TableXform extends BaseXform {\n  constructor() {\n    super();\n\n    this.map = {\n      autoFilter: new AutoFilterXform(),\n      tableColumns: new ListXform({\n        tag: 'tableColumns',\n        count: true,\n        empty: true,\n        childXform: new TableColumnXform(),\n      }),\n      tableStyleInfo: new TableStyleInfoXform(),\n    };\n  }\n\n  prepare(model, options) {\n    this.map.autoFilter.prepare(model);\n    this.map.tableColumns.prepare(model.columns, options);\n  }\n\n  get tag() {\n    return 'table';\n  }\n\n  render(xmlStream, model) {\n    xmlStream.openXml(XmlStream.StdDocAttributes);\n    xmlStream.openNode(this.tag, {\n      ...TableXform.TABLE_ATTRIBUTES,\n      id: model.id,\n      name: model.name,\n      displayName: model.displayName || model.name,\n      ref: model.tableRef,\n      totalsRowCount: model.totalsRow ? '1' : undefined,\n      totalsRowShown: model.totalsRow ? undefined: '1',\n      headerRowCount: model.headerRow ? '1' : '0',\n    });\n\n    this.map.autoFilter.render(xmlStream, model);\n    this.map.tableColumns.render(xmlStream, model.columns);\n    this.map.tableStyleInfo.render(xmlStream, model.style);\n\n    xmlStream.closeNode();\n  }\n\n  parseOpen(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n    const {name, attributes} = node;\n    switch (name) {\n      case this.tag:\n        this.reset();\n        this.model = {\n          name: attributes.name,\n          displayName: attributes.displayName || attributes.name,\n          tableRef: attributes.ref,\n          totalsRow: attributes.totalsRowCount === '1',\n          headerRow: attributes.headerRowCount === '1',\n        };\n        break;\n      default:\n        this.parser = this.map[node.name];\n        if (this.parser) {\n          this.parser.parseOpen(node);\n        }\n        break;\n    }\n    return true;\n  }\n\n  parseText(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  }\n\n  parseClose(name) {\n    if (this.parser) {\n      if (!this.parser.parseClose(name)) {\n        this.parser = undefined;\n      }\n      return true;\n    }\n    switch (name) {\n      case this.tag:\n        this.model.autoFilterRef = this.map.autoFilter.model.autoFilterRef;\n        this.model.columns = this.map.tableColumns.model;\n        this.map.autoFilter.model.columns.forEach((column, index) => {\n          this.model.columns[index].filterButton = column.filterButton;\n        });\n        this.model.style = this.map.tableStyleInfo.model;\n        return false;\n      default:\n        // could be some unrecognised tags\n        return true;\n    }\n  }\n\n  reconcile(model, options) {\n    // fetch the dfxs from styles\n    model.columns.forEach(column => {\n      if (column.dxfId !== undefined) {\n        column.style = options.styles.getDxfStyle(column.dxfId);\n      }\n    });\n  }\n}\n\n\nTableXform.TABLE_ATTRIBUTES = {\n  'xmlns': 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\n  'xmlns:mc': 'http://schemas.openxmlformats.org/markup-compatibility/2006',\n  'mc:Ignorable': 'xr xr3',\n  'xmlns:xr': 'http://schemas.microsoft.com/office/spreadsheetml/2014/revision',\n  'xmlns:xr3': 'http://schemas.microsoft.com/office/spreadsheetml/2016/revision3',\n  // 'xr:uid': '{00000000-000C-0000-FFFF-FFFF00000000}',\n};\n\nmodule.exports = TableXform;\n"],"file":"table-xform.js"}