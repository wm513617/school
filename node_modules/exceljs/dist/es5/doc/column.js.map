{"version":3,"sources":["../../../lib/doc/column.js"],"names":["_","require","Enums","colCache","Column","worksheet","number","defn","_worksheet","_number","JSON","stringify","key","width","headers","length","undefined","other","hidden","outlineLevel","isEqual","style","options","iteratee","colNumber","eachRow","row","rowNumber","getCell","name","value","eachCell","cell","n2l","header","_header","_hidden","_key","Array","forEach","text","index","column","getColumnKey","deleteColumnKey","setColumnKey","_outlineLevel","properties","outlineLevelCol","isCustomWidth","s","font","numFmt","alignment","border","fill","protection","v","type","ValueType","Null","offset","hasOwnProperty","_applyStyle","columns","cols","col","isDefault","equivalentTo","min","max","collapsed","push","count","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nconst _ = require('../utils/under-dash');\n\nconst Enums = require('./enums');\nconst colCache = require('../utils/col-cache');\n\n// Column defines the column properties for 1 column.\n// This includes header rows, widths, key, (style), etc.\n// Worksheet will condense the columns as appropriate during serialization\nclass Column {\n  constructor(worksheet, number, defn) {\n    this._worksheet = worksheet;\n    this._number = number;\n    if (defn !== false) {\n      // sometimes defn will follow\n      this.defn = defn;\n    }\n  }\n\n  get number() {\n    return this._number;\n  }\n\n  get worksheet() {\n    return this._worksheet;\n  }\n\n  get letter() {\n    return colCache.n2l(this._number);\n  }\n\n  get isCustomWidth() {\n    return this.width !== undefined && this.width !== 8;\n  }\n\n  get defn() {\n    return {\n      header: this._header,\n      key: this.key,\n      width: this.width,\n      style: this.style,\n      hidden: this.hidden,\n      outlineLevel: this.outlineLevel,\n    };\n  }\n\n  set defn(value) {\n    if (value) {\n      this.key = value.key;\n      this.width = value.width;\n      this.outlineLevel = value.outlineLevel;\n      if (value.style) {\n        this.style = value.style;\n      } else {\n        this.style = {};\n      }\n\n      // headers must be set after style\n      this.header = value.header;\n      this._hidden = !!value.hidden;\n    } else {\n      delete this._header;\n      delete this._key;\n      delete this.width;\n      this.style = {};\n      this.outlineLevel = 0;\n    }\n  }\n\n  get headers() {\n    return this._header && this._header instanceof Array ? this._header : [this._header];\n  }\n\n  get header() {\n    return this._header;\n  }\n\n  set header(value) {\n    if (value !== undefined) {\n      this._header = value;\n      this.headers.forEach((text, index) => {\n        this._worksheet.getCell(index + 1, this.number).value = text;\n      });\n    } else {\n      this._header = undefined;\n    }\n  }\n\n  get key() {\n    return this._key;\n  }\n\n  set key(value) {\n    const column = this._key && this._worksheet.getColumnKey(this._key);\n    if (column === this) {\n      this._worksheet.deleteColumnKey(this._key);\n    }\n\n    this._key = value;\n    if (value) {\n      this._worksheet.setColumnKey(this._key, this);\n    }\n  }\n\n  get hidden() {\n    return !!this._hidden;\n  }\n\n  set hidden(value) {\n    this._hidden = value;\n  }\n\n  get outlineLevel() {\n    return this._outlineLevel || 0;\n  }\n\n  set outlineLevel(value) {\n    this._outlineLevel = value;\n  }\n\n  get collapsed() {\n    return !!(this._outlineLevel && this._outlineLevel >= this._worksheet.properties.outlineLevelCol);\n  }\n\n  toString() {\n    return JSON.stringify({\n      key: this.key,\n      width: this.width,\n      headers: this.headers.length ? this.headers : undefined,\n    });\n  }\n\n  equivalentTo(other) {\n    return this.width === other.width && this.hidden === other.hidden && this.outlineLevel === other.outlineLevel && _.isEqual(this.style, other.style);\n  }\n\n  get isDefault() {\n    if (this.isCustomWidth) {\n      return false;\n    }\n    if (this.hidden) {\n      return false;\n    }\n    if (this.outlineLevel) {\n      return false;\n    }\n    const s = this.style;\n    if (s && (s.font || s.numFmt || s.alignment || s.border || s.fill || s.protection)) {\n      return false;\n    }\n    return true;\n  }\n\n  get headerCount() {\n    return this.headers.length;\n  }\n\n  eachCell(options, iteratee) {\n    const colNumber = this.number;\n    if (!iteratee) {\n      iteratee = options;\n      options = null;\n    }\n    this._worksheet.eachRow(options, (row, rowNumber) => {\n      iteratee(row.getCell(colNumber), rowNumber);\n    });\n  }\n\n  get values() {\n    const v = [];\n    this.eachCell((cell, rowNumber) => {\n      if (cell && cell.type !== Enums.ValueType.Null) {\n        v[rowNumber] = cell.value;\n      }\n    });\n    return v;\n  }\n\n  set values(v) {\n    if (!v) {\n      return;\n    }\n    const colNumber = this.number;\n    let offset = 0;\n    if (v.hasOwnProperty('0')) {\n      // assume contiguous array, start at row 1\n      offset = 1;\n    }\n    v.forEach((value, index) => {\n      this._worksheet.getCell(index + offset, colNumber).value = value;\n    });\n  }\n\n  // =========================================================================\n  // styles\n  _applyStyle(name, value) {\n    this.style[name] = value;\n    this.eachCell(cell => {\n      cell[name] = value;\n    });\n    return value;\n  }\n\n  get numFmt() {\n    return this.style.numFmt;\n  }\n\n  set numFmt(value) {\n    this._applyStyle('numFmt', value);\n  }\n\n  get font() {\n    return this.style.font;\n  }\n\n  set font(value) {\n    this._applyStyle('font', value);\n  }\n\n  get alignment() {\n    return this.style.alignment;\n  }\n\n  set alignment(value) {\n    this._applyStyle('alignment', value);\n  }\n\n  get protection() {\n    return this.style.protection;\n  }\n\n  set protection(value) {\n    this._applyStyle('protection', value);\n  }\n\n  get border() {\n    return this.style.border;\n  }\n\n  set border(value) {\n    this._applyStyle('border', value);\n  }\n\n  get fill() {\n    return this.style.fill;\n  }\n\n  set fill(value) {\n    this._applyStyle('fill', value);\n  }\n\n  // =============================================================================\n  // static functions\n\n  static toModel(columns) {\n    // Convert array of Column into compressed list cols\n    const cols = [];\n    let col = null;\n    if (columns) {\n      columns.forEach((column, index) => {\n        if (column.isDefault) {\n          if (col) {\n            col = null;\n          }\n        } else if (!col || !column.equivalentTo(col)) {\n          col = {\n            min: index + 1,\n            max: index + 1,\n            width: column.width,\n            style: column.style,\n            isCustomWidth: column.isCustomWidth,\n            hidden: column.hidden,\n            outlineLevel: column.outlineLevel,\n            collapsed: column.collapsed,\n          };\n          cols.push(col);\n        } else {\n          col.max = index + 1;\n        }\n      });\n    }\n    return cols.length ? cols : undefined;\n  }\n\n  static fromModel(worksheet, cols) {\n    cols = cols || [];\n    const columns = [];\n    let count = 1;\n    let index = 0;\n    while (index < cols.length) {\n      const col = cols[index++];\n      while (count < col.min) {\n        columns.push(new Column(worksheet, count++));\n      }\n      while (count <= col.max) {\n        columns.push(new Column(worksheet, count++, col));\n      }\n    }\n    return columns.length ? columns : null;\n  }\n}\n\nmodule.exports = Column;\n"],"file":"column.js"}