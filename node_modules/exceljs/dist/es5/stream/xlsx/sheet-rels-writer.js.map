{"version":3,"sources":["../../../../lib/stream/xlsx/sheet-rels-writer.js"],"names":["utils","require","RelType","HyperlinksProxy","sheetRelsWriter","writer","prototype","push","hyperlink","addHyperlink","SheetRelsWriter","module","exports","options","id","count","_hyperlinks","_workbook","workbook","stream","_stream","_openStream","length","each","fn","forEach","hyperlinksProxy","_hyperlinksProxy","relationship","Target","target","Type","Hyperlink","TargetMode","rId","_writeRelationship","address","addMedia","media","commit","_writeClose","end","_writeOpen","write","xmlEncode"],"mappings":"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","sourcesContent":["'use strict';\n\nconst utils = require('../../utils/utils');\nconst RelType = require('../../xlsx/rel-type');\n\nconst HyperlinksProxy = function(sheetRelsWriter) {\n  this.writer = sheetRelsWriter;\n};\nHyperlinksProxy.prototype = {\n  push(hyperlink) {\n    this.writer.addHyperlink(hyperlink);\n  },\n};\n\nconst SheetRelsWriter = (module.exports = function(options) {\n  // in a workbook, each sheet will have a number\n  this.id = options.id;\n\n  // count of all relationships\n  this.count = 0;\n\n  // keep record of all hyperlinks\n  this._hyperlinks = [];\n\n  this._workbook = options.workbook;\n});\nSheetRelsWriter.prototype = {\n  get stream() {\n    if (!this._stream) {\n      // eslint-disable-next-line no-underscore-dangle\n      this._stream = this._workbook._openStream(`/xl/worksheets/_rels/sheet${this.id}.xml.rels`);\n    }\n    return this._stream;\n  },\n\n  get length() {\n    return this._hyperlinks.length;\n  },\n\n  each(fn) {\n    return this._hyperlinks.forEach(fn);\n  },\n\n  get hyperlinksProxy() {\n    return this._hyperlinksProxy || (this._hyperlinksProxy = new HyperlinksProxy(this));\n  },\n  addHyperlink(hyperlink) {\n    // Write to stream\n    const relationship = {\n      Target: hyperlink.target,\n      Type: RelType.Hyperlink,\n      TargetMode: 'External',\n    };\n    const rId = this._writeRelationship(relationship);\n\n    // store sheet stuff for later\n    this._hyperlinks.push({\n      rId,\n      address: hyperlink.address,\n    });\n  },\n\n  addMedia(media) {\n    return this._writeRelationship(media);\n  },\n\n  commit() {\n    if (this.count) {\n      // write xml utro\n      this._writeClose();\n      // and close stream\n      this.stream.end();\n    }\n  },\n\n  // ================================================================================\n  _writeOpen() {\n    this.stream.write(\n      '<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>' + '<Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">'\n    );\n  },\n  _writeRelationship(relationship) {\n    if (!this.count) {\n      this._writeOpen();\n    }\n\n    const rId = `rId${++this.count}`;\n\n    if (relationship.TargetMode) {\n      this.stream.write(\n        `${'<Relationship' + ' Id=\"'}${rId}\"` +\n          ` Type=\"${relationship.Type}\"` +\n          ` Target=\"${utils.xmlEncode(relationship.Target)}\"` +\n          ` TargetMode=\"${relationship.TargetMode}\"` +\n          '/>'\n      );\n    } else {\n      this.stream.write(`${'<Relationship' + ' Id=\"'}${rId}\"` + ` Type=\"${relationship.Type}\"` + ` Target=\"${relationship.Target}\"` + '/>');\n    }\n\n    return rId;\n  },\n  _writeClose() {\n    this.stream.write('</Relationships>');\n  },\n};\n"],"file":"sheet-rels-writer.js"}