{"version":3,"sources":["../../../../lib/stream/xlsx/hyperlink-reader.js"],"names":["events","require","Sax","utils","Enums","RelType","HyperlinkReader","module","exports","workbook","id","_workbook","inherits","EventEmitter","count","hyperlinks","length","each","fn","forEach","read","entry","options","self","emitHyperlinks","autodrain","emit","parser","createStream","on","node","name","rId","attributes","Id","Type","Hyperlink","relationship","type","RelationshipType","Styles","target","Target","targetMode","TargetMode","flowControl","createChild","pipe","sync"],"mappings":"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","sourcesContent":["'use strict';\n\nconst events = require('events');\nconst Sax = require('sax');\n\nconst utils = require('../../utils/utils');\nconst Enums = require('../../doc/enums');\nconst RelType = require('../../xlsx/rel-type');\n\nconst HyperlinkReader = (module.exports = function(workbook, id) {\n  // in a workbook, each sheet will have a number\n  this.id = id;\n\n  this._workbook = workbook;\n});\n\nutils.inherits(HyperlinkReader, events.EventEmitter, {\n  get count() {\n    return (this.hyperlinks && this.hyperlinks.length) || 0;\n  },\n\n  each(fn) {\n    return this.hyperlinks.forEach(fn);\n  },\n\n  read(entry, options) {\n    const self = this;\n    let emitHyperlinks = false;\n    let hyperlinks = null;\n    switch (options.hyperlinks) {\n      case 'emit':\n        emitHyperlinks = true;\n        break;\n      case 'cache':\n        this.hyperlinks = hyperlinks = {};\n        break;\n      default:\n        break;\n    }\n    if (!emitHyperlinks && !hyperlinks) {\n      entry.autodrain();\n      self.emit('finished');\n      return;\n    }\n\n    const parser = Sax.createStream(true, {});\n    parser.on('opentag', node => {\n      if (node.name === 'Relationship') {\n        const rId = node.attributes.Id;\n        switch (node.attributes.Type) {\n          case RelType.Hyperlink:\n            const relationship = {\n              type: Enums.RelationshipType.Styles,\n              rId,\n              target: node.attributes.Target,\n              targetMode: node.attributes.TargetMode,\n            };\n            if (emitHyperlinks) {\n              self.emit('hyperlink', relationship);\n            } else {\n              hyperlinks[relationship.rId] = relationship;\n            }\n            break;\n          default:\n            break;\n        }\n      }\n    });\n    parser.on('end', () => {\n      self.emit('finished');\n    });\n\n    // create a down-stream flow-control to regulate the stream\n    const flowControl = this._workbook.flowControl.createChild();\n    flowControl.pipe(\n      parser,\n      { sync: true }\n    );\n    entry.pipe(flowControl);\n  },\n});\n"],"file":"hyperlink-reader.js"}